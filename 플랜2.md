# 미니게임 플랫폼 - Phase 2 기획서

## 현재 완료된 게임
- ✅ 스도쿠 (5단계 난이도)
- ✅ 2048 (무한 목표 시스템)
- ✅ 메모리 카드 게임 (3단계 난이도)
- ✅ 지뢰찾기 (3단계 난이도)
- ✅ 워들 (일일/무한 모드)
- ✅ 슬라이딩 퍼즐 (3x3, 4x4, 5x5)
- ✅ 타이핑 게임 (3단계 난이도)
- ✅ 반응속도 테스트 (3/5/10회)
- ✅ 숫자 야구 (3자리, 4자리)

---

## 1. 추가 게임 라인업

### 1.1 워들 (Wordle) 클론
- 5글자 영단어 맞추기
- 6번의 기회
- 색상 힌트: 🟩 정확 / 🟨 위치 틀림 / ⬜ 없음
- 일일 단어 모드 + 무한 모드
- 용량: ~25KB

### 1.2 슬라이딩 퍼즐 (15 Puzzle)
- 4x4 그리드에서 숫자/이미지 정렬
- 난이도: 3x3, 4x4, 5x5
- 최소 이동 횟수 도전
- 용량: ~20KB

### 1.3 행맨 (Hangman)
- 단어 맞추기 게임
- 카테고리별 단어 (동물, 음식, 나라 등)
- 힌트 기능
- 용량: ~15KB

### 1.4 타이핑 게임
- 떨어지는 단어 타이핑
- 난이도별 속도 조절
- WPM(분당 타자 수) 측정
- 용량: ~20KB

### 1.5 색상 맞추기 (Color Match)
- RGB 값 보고 색상 선택
- 반대로 색상 보고 RGB 추측
- 시간 제한 모드
- 용량: ~15KB

### 1.6 반응속도 테스트
- 화면 색상 변할 때 클릭
- 평균 반응속도 측정
- 여러 라운드 진행
- 용량: ~10KB

### 1.7 숫자 야구 (Bulls and Cows)
- 3~4자리 숫자 맞추기
- 스트라이크/볼 힌트
- 최소 시도 횟수 도전
- 용량: ~15KB

---

## 2. 랭킹 시스템

### 2.1 아키텍처

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   게임 UI    │────▶│  Next.js API │────▶│   Supabase   │
│  (Client)    │     │   Routes     │     │  (PostgreSQL)│
└──────────────┘     └──────────────┘     └──────────────┘
                            │
                            ▼
                     ┌──────────────┐
                     │   Redis      │
                     │  (캐싱/선택) │
                     └──────────────┘
```

### 2.2 DB 스키마 (Supabase)

```sql
-- 사용자 테이블
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  nickname VARCHAR(20) NOT NULL UNIQUE,
  created_at TIMESTAMP DEFAULT NOW()
);

-- 게임 점수 테이블
CREATE TABLE scores (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  game_type VARCHAR(20) NOT NULL,  -- sudoku, puzzle2048, memory, minesweeper, etc
  difficulty VARCHAR(20),           -- easy, normal, hard, etc
  score INTEGER NOT NULL,
  time_seconds INTEGER,             -- 클리어 시간 (초)
  metadata JSONB,                   -- 게임별 추가 정보
  created_at TIMESTAMP DEFAULT NOW()
);

-- 인덱스
CREATE INDEX idx_scores_game_type ON scores(game_type);
CREATE INDEX idx_scores_created_at ON scores(created_at DESC);
CREATE INDEX idx_scores_ranking ON scores(game_type, difficulty, score DESC);

-- 일간 랭킹 뷰
CREATE VIEW daily_ranking AS
SELECT
  s.game_type,
  s.difficulty,
  u.nickname,
  MAX(s.score) as best_score,
  MIN(s.time_seconds) as best_time
FROM scores s
JOIN users u ON s.user_id = u.id
WHERE s.created_at > NOW() - INTERVAL '1 day'
GROUP BY s.game_type, s.difficulty, u.id, u.nickname
ORDER BY best_score DESC;
```

### 2.3 API 엔드포인트

```
POST /api/auth/register     - 닉네임 등록 (익명)
GET  /api/auth/me           - 내 정보 조회

POST /api/scores            - 점수 제출
GET  /api/scores/ranking    - 랭킹 조회
     ?game=sudoku
     &difficulty=normal
     &period=daily|weekly|all
     &limit=100

GET  /api/scores/my         - 내 기록 조회
```

### 2.4 점수 산정 방식

#### 스도쿠
```
점수 = (난이도 가중치 × 10000) - (소요시간 × 10) - (힌트 사용 × 500)
```
| 난이도 | 가중치 |
|--------|--------|
| Normal | 1.0 |
| Hard | 1.5 |
| Expert | 2.0 |
| Master | 3.0 |
| Extreme | 5.0 |

#### 2048
```
점수 = 게임 내 점수 (그대로 사용)
추가 기록: 최고 타일
```

#### 메모리 게임
```
점수 = (난이도 기본점수) - (추가 시도 × 50) - (소요시간 × 5)
```
| 난이도 | 기본점수 | 최소시도 |
|--------|---------|---------|
| Easy | 6000 | 6 |
| Normal | 8000 | 8 |
| Hard | 12000 | 12 |

#### 지뢰찾기
```
점수 = (난이도 기본점수) - (소요시간 × 10)
```
| 난이도 | 기본점수 |
|--------|---------|
| Easy | 5000 |
| Normal | 10000 |
| Hard | 20000 |

### 2.5 사용자 인증 (간소화)

1. **익명 모드 (기본)**
   - 닉네임만 입력
   - UUID를 localStorage에 저장
   - 기기 변경 시 기록 유실

2. **영구 모드 (선택)**
   - 이메일 인증 또는 OAuth (Google, GitHub)
   - Supabase Auth 사용
   - 여러 기기에서 기록 연동

### 2.6 랭킹 UI

```
┌─────────────────────────────────────┐
│  🏆 스도쿠 랭킹 - Expert           │
├─────────────────────────────────────┤
│  📅 일간 | 주간 | 전체              │
├─────┬──────────┬────────┬──────────┤
│ 순위 │ 닉네임   │ 점수   │ 시간    │
├─────┼──────────┼────────┼──────────┤
│ 🥇 1 │ Player1  │ 9,500  │ 05:23   │
│ 🥈 2 │ Player2  │ 9,200  │ 06:11   │
│ 🥉 3 │ Player3  │ 8,800  │ 07:45   │
│   4  │ Player4  │ 8,500  │ 08:02   │
│   5  │ ...      │ ...    │ ...     │
└─────┴──────────┴────────┴──────────┘
│        📊 내 순위: 42위            │
└─────────────────────────────────────┘
```

---

## 3. 개발 로드맵

### Phase 2-1: 추가 게임 (게임당 1일)
- [x] 워들 클론
- [x] 슬라이딩 퍼즐
- [x] 타이핑 게임
- [x] 반응속도 테스트
- [x] 숫자 야구

### Phase 2-2: 랭킹 시스템 기반
- [ ] Supabase 프로젝트 설정
- [ ] DB 스키마 생성
- [ ] 인증 시스템 (닉네임 기반)
- [ ] API Routes 구현

### Phase 2-3: 랭킹 UI
- [ ] 랭킹 보드 컴포넌트
- [ ] 게임 종료 시 점수 제출 연동
- [ ] 내 기록 페이지

### Phase 2-4: 개선
- [ ] 랭킹 캐싱 (선택)
- [ ] 치트 방지 기본 검증
- [ ] 성능 최적화

---

## 4. 기술 스택 추가

### 백엔드
- **Supabase**: PostgreSQL + Auth + Realtime
- **Next.js API Routes**: 서버리스 API

### 인증
- **Supabase Auth**: 익명 + OAuth
- **localStorage**: 익명 사용자 UUID 저장

### 선택사항
- **Upstash Redis**: 랭킹 캐싱 (무료 티어)
- **Vercel KV**: 대안 캐싱 솔루션

---

## 5. 폴더 구조 추가

```
/src
├── app/
│   ├── api/
│   │   ├── auth/
│   │   │   ├── register/route.ts
│   │   │   └── me/route.ts
│   │   └── scores/
│   │       ├── route.ts          # POST (점수 제출)
│   │       ├── ranking/route.ts  # GET (랭킹 조회)
│   │       └── my/route.ts       # GET (내 기록)
│   │
│   ├── ranking/
│   │   └── page.tsx              # 랭킹 페이지
│   │
│   ├── wordle/page.tsx           # 추가 게임들
│   ├── sliding-puzzle/page.tsx
│   ├── typing/page.tsx
│   └── reaction/page.tsx
│
├── components/
│   ├── ranking/
│   │   ├── RankingBoard.tsx
│   │   ├── ScoreSubmit.tsx
│   │   └── MyRecords.tsx
│   └── games/
│       ├── wordle/
│       ├── sliding-puzzle/
│       ├── typing/
│       └── reaction/
│
├── lib/
│   ├── supabase.ts               # Supabase 클라이언트
│   ├── auth.ts                   # 인증 유틸리티
│   └── games/
│       ├── wordle.ts
│       ├── sliding-puzzle.ts
│       ├── typing.ts
│       └── reaction.ts
│
└── types/
    └── ranking.ts                # 랭킹 관련 타입
```

---

## 6. 우선순위

### 높음 (필수)
1. 랭킹 시스템 기반 구축
2. 기존 4개 게임에 점수 제출 연동
3. 랭킹 보드 UI

### 중간 (권장)
4. 워들 클론 추가
5. 슬라이딩 퍼즐 추가
6. 반응속도 테스트 추가

### 낮음 (선택)
7. 타이핑 게임
8. 숫자 야구
9. OAuth 연동
10. 랭킹 캐싱

---

## 7. 예상 비용

| 서비스 | 무료 티어 | 예상 사용량 |
|--------|---------|------------|
| Supabase | DB 500MB, Auth 무제한 | 충분 |
| Vercel | 100GB 대역폭 | 충분 |
| Upstash Redis (선택) | 10K 요청/일 | 충분 |

**총 예상 비용: $0 (무료 티어 내)**
